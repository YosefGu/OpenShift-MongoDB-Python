
-- create a persistent volume -- 
oc apply -f - <<EOF 
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: mongodb-pvc
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 2Gi   
  storageClassName: gp3
EOF


-- create a mongodb-server --
oc new-app docker.io/library/mongo:7.0.23 \
    --name=mongodb-server \
    -e MONGO_INITDB_ROOT_USERNAME=admin \
    -e MONGO_INITDB_ROOT_PASSWORD=secretpassword \
    -e MONGO_INITDB_DATABASE=database \

-- delete existing volume --
oc set volume deployment/mongodb-server --remove --name=mongodb-server-volume-2

-- connecting a PVC --
oc set volume deployment/mongodb-server \
  --add \
  --name=mongodb-storage \
  --mount-path=/data/db \
  --claim-name=mongodb-pvc


-- entering to mongo DB in pod --
oc rsh <mongo db pod id>
mongosh -u admin -p secretpassword --authenticationDatabase admin
use database
show collections

-- create a collection --
db.createCollection(<collection name>)

-- add document --
db.<collection name>.insert({data})


-- create server to present data -- 
oc new-app https://github.com/YosefGu/OpenShift-MongoDB-Python \
  --name=python-mongodb-app \
  -e MONGO_HOST=mongodb-server \
  -e MONGO_USER=admin \
  -e MONGO_PASSWORD=secretpassword \
  -e MONGO_DATABASE=database


-- create a service for mongodb python server container --
oc expose deployment/python-mongodb-app --port=8001 --target-port=8001 --name=mongodb-python-svc


-- expose the service --
oc expose svc/mongodb-python-svc